<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Search Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .input { @apply border border-gray-300 rounded px-3 py-2 text-sm; }
        .input-sm { @apply py-1 text-xs; }
        .input-bordered { @apply border-gray-300; }
        .btn { @apply px-4 py-2 rounded font-medium text-sm cursor-pointer; }
        .btn-outline { @apply border border-gray-300 bg-white text-gray-700 hover:bg-gray-50; }
        .btn-sm { @apply px-3 py-1 text-xs; }
        .form-control { @apply flex flex-col; }
        .label { @apply mb-1; }
        .label-text { @apply text-gray-600; }
        .text-primary { @apply text-blue-600; }
        .text-success { @apply text-green-600; }
        .text-error { @apply text-red-600; }
        .text-warning { @apply text-yellow-600; }
        .fa-spin { animation: fa-spin 1s infinite linear; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6">üåç Location Search Test</h1>
        
        <div class="mb-4">
            <div class="flex items-center gap-2">
                <label class="label">
                    <span class="label-text text-sm">Location:</span>
                </label>
                <div class="form-control relative flex-1">
                    <input 
                        type="text" 
                        id="testLocationInput" 
                        class="input input-bordered input-sm w-full" 
                        placeholder="Enter city name..."
                        title="Enter a city name (e.g., Milan, London, New York)"
                    />
                    <div id="testLocationStatus" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-xs">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mb-4 p-3 bg-gray-50 rounded text-sm">
            <div><strong>Current Location:</strong> <span id="currentLocationDisplay">Not set</span></div>
            <div><strong>Coordinates:</strong> <span id="coordinatesDisplay">-</span></div>
        </div>
        
        <div class="mb-4">
            <h3 class="font-semibold mb-2">Test Instructions:</h3>
            <ul class="text-sm text-gray-600 space-y-1">
                <li>‚Ä¢ Type a city name (e.g., "Paris", "Tokyo", "Sydney")</li>
                <li>‚Ä¢ Wait 1 second for automatic search, or press Enter</li>
                <li>‚Ä¢ Watch the status icon change (üîç‚Üí‚è≥‚Üí‚úÖ/‚ùå)</li>
                <li>‚Ä¢ If no API key is set, demo data is used for common cities</li>
            </ul>
        </div>
        
        <div class="text-xs text-gray-500 mt-4 p-2 bg-blue-50 rounded">
            <strong>Note:</strong> This test uses the same geocoding functionality as the main weather app. 
            Configure your OpenWeatherMap API key in the main app's configuration for live geocoding.
        </div>
    </div>

    <script>
        // Minimal test implementation
        let testGeocodingTimer = null;
        
        // Demo location data for testing
        const demoLocations = {
            'milan': { name: 'Milan', country: 'IT', lat: 45.4642, lon: 9.1900 },
            'london': { name: 'London', country: 'GB', lat: 51.5074, lon: -0.1278 },
            'paris': { name: 'Paris', country: 'FR', lat: 48.8566, lon: 2.3522 },
            'berlin': { name: 'Berlin', country: 'DE', lat: 52.5200, lon: 13.4050 },
            'madrid': { name: 'Madrid', country: 'ES', lat: 40.4168, lon: -3.7038 },
            'tokyo': { name: 'Tokyo', country: 'JP', lat: 35.6762, lon: 139.6503 },
            'new york': { name: 'New York', country: 'US', lat: 40.7128, lon: -74.0060 },
            'sydney': { name: 'Sydney', country: 'AU', lat: -33.8688, lon: 151.2093 }
        };
        
        function getDemoLocationData(locationName) {
            const key = locationName.toLowerCase().trim();
            return demoLocations[key] || null;
        }
        
        async function testGeocodeLocation(locationName) {
            const statusDiv = document.getElementById('testLocationStatus');
            const currentDisplay = document.getElementById('currentLocationDisplay');
            const coordinatesDisplay = document.getElementById('coordinatesDisplay');
            
            try {
                // Show loading
                statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin text-primary"></i>';
                
                console.log(`üß™ Testing geocoding for: ${locationName}`);
                
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Try demo data first
                const demoData = getDemoLocationData(locationName);
                if (demoData) {
                    // Show success
                    statusDiv.innerHTML = '<i class="fas fa-check text-success"></i>';
                    currentDisplay.textContent = `${demoData.name}, ${demoData.country}`;
                    coordinatesDisplay.textContent = `${demoData.lat.toFixed(4)}, ${demoData.lon.toFixed(4)}`;
                    
                    console.log('‚úÖ Demo location found:', demoData);
                    return demoData;
                } else {
                    // Location not found in demo data
                    throw new Error('Location not found in demo data');
                }
                
            } catch (error) {
                console.error('‚ùå Test geocoding error:', error);
                statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle text-error"></i>';
                statusDiv.title = `Error: ${error.message}`;
                return null;
            }
        }
        
        function debouncedSearch(callback, delay = 1000) {
            return function(locationName) {
                clearTimeout(testGeocodingTimer);
                testGeocodingTimer = setTimeout(() => {
                    callback(locationName);
                }, delay);
            };
        }
        
        const handleTestSearch = debouncedSearch(async (locationName) => {
            if (!locationName || locationName.length < 2) {
                return;
            }
            
            await testGeocodeLocation(locationName);
        });
        
        // Initialize test
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('testLocationInput');
            const statusDiv = document.getElementById('testLocationStatus');
            
            // Set default value
            input.value = 'Milan';
            testGeocodeLocation('Milan');
            
            // Input event
            input.addEventListener('input', function(e) {
                const value = e.target.value.trim();
                
                if (statusDiv && value.length > 0) {
                    statusDiv.innerHTML = '<i class="fas fa-search text-gray-400"></i>';
                    statusDiv.title = '';
                }
                
                if (value.length >= 2) {
                    handleTestSearch(value);
                }
            });
            
            // Enter key
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const value = e.target.value.trim();
                    
                    if (value.length >= 2) {
                        clearTimeout(testGeocodingTimer);
                        testGeocodeLocation(value);
                    }
                }
            });
            
            // Focus to select all
            input.addEventListener('focus', function() {
                this.select();
            });
        });
    </script>
</body>
</html>